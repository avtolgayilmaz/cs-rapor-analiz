<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS Pro Analytics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .header h1 { margin: 0; }
        .nav { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .nav button { background: rgba(255,255,255,0.2); border: none; color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .nav button:hover, .nav button.active { background: white; color: #667eea; }
        .section { display: none; background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .section.active { display: block; }
        .upload-zone { border: 3px dashed #ccc; border-radius: 10px; padding: 40px; text-align: center; background: #fafafa; cursor: pointer; transition: all 0.3s; }
        .upload-zone:hover { border-color: #667eea; background: #f0f0ff; }
        .btn { background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; margin: 5px; }
        .btn:hover { background: #5568d3; }
        .btn-secondary { background: #6c757d; }
        .grid-4 { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; border-top: 4px solid #667eea; }
        .stat-value { font-size: 32px; font-weight: bold; color: #333; margin: 10px 0; }
        .stat-label { color: #666; font-size: 14px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #667eea; color: white; }
        tr:hover { background: #f5f5f5; }
        .badge { padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold; }
        .badge-tp { background: #d4edda; color: #155724; }
        .badge-fn { background: #fff3cd; color: #856404; }
        .badge-fp { background: #f8d7da; color: #721c24; }
        .badge-tn { background: #d1ecf1; color: #0c5460; }
        .badge-lock { background: #e2e3e5; color: #383d41; }
        .config-group { margin: 15px 0; }
        .config-group label { display: block; font-weight: bold; margin-bottom: 5px; }
        .config-group select, .config-group input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; }
        .cs-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .cs-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-left: 5px solid #667eea; }
        .hidden { display: none !important; }
        .progress-bar { height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: #667eea; transition: width 0.3s; }
        .filter-bar { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .filter-bar select, .filter-bar input { padding: 8px; border: 1px solid #ddd; border-radius: 5px; }
        .alert { padding: 15px; background: #e7f3ff; border-left: 4px solid #667eea; margin: 10px 0; border-radius: 5px; }
    </style>
<base target="_blank">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>CS Pro Analytics</h1>
            <div class="nav">
                <button onclick="showSection('upload')" id="btn-upload" class="active">Y√ºkle</button>
                <button onclick="showSection('dashboard')" id="btn-dashboard">Dashboard</button>
                <button onclick="showSection('scores')" id="btn-scores">CS Puanlarƒ±</button>
                <button onclick="showSection('details')" id="btn-details">Detaylar</button>
                <button onclick="showSection('config')" id="btn-config">Ayarlar</button>
            </div>
        </div>

        <!-- Upload Section -->
        <div id="section-upload" class="section active">
            <h2>Excel Dosyasƒ± Y√ºkleme</h2>
            <div class="upload-zone" id="dropZone">
                <h3>üìÅ Dosyayƒ± Buraya S√ºr√ºkleyin veya Tƒ±klayƒ±n</h3>
                <p>.xlsx formatƒ± desteklenir</p>
                <input type="file" id="fileInput" accept=".xlsx" style="display: none;">
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button class="btn btn-secondary" onclick="loadDemoData()">Demo Veri Y√ºkle</button>
            </div>

            <div id="mappingPanel" class="hidden" style="margin-top: 30px;">
                <h3>S√ºtun E≈üle≈ütirme</h3>
                <div id="mappingContainer"></div>
                <button class="btn" onclick="processData()" style="margin-top: 20px;">Analizi Ba≈ülat</button>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="section-dashboard" class="section">
            <h2>Genel Bakƒ±≈ü</h2>
            <div class="grid-4">
                <div class="stat-card">
                    <div class="stat-label">Doƒüru ƒ∞≈ülem (TP)</div>
                    <div class="stat-value" id="val-tp">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Eksik ƒ∞≈ülem (FN)</div>
                    <div class="stat-value" id="val-fn">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Fazla ƒ∞≈ülem (FP)</div>
                    <div class="stat-value" id="val-fp">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Toplam</div>
                    <div class="stat-value" id="val-total">0</div>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div><canvas id="chart1"></canvas></div>
                <div><canvas id="chart2"></canvas></div>
            </div>
        </div>

        <!-- Scores Section -->
        <div id="section-scores" class="section">
            <h2>CS Performans Puanlamasƒ±</h2>
            <div class="alert">
                <strong>Puanlama Kriterleri:</strong><br>
                1. Etkili ƒ∞≈ülem Oranƒ± (60%): ‚â•%80=18p, ‚â•%60=13p, ‚â•%40=8p, <%40=3p<br>
                2. ƒ∞≈ülem S√ºresi (40%): ‚â§24s=12p, >24s=4p
            </div>
            <div id="csScores" class="cs-grid"></div>
            <canvas id="csChart" style="margin-top: 30px;"></canvas>
        </div>

        <!-- Details Section -->
        <div id="section-details" class="section">
            <h2>Detaylƒ± Kayƒ±tlar</h2>
            <div class="filter-bar">
                <select id="filterCS" onchange="applyFilters()"><option value="">T√ºm CS'ler</option></select>
                <select id="filterType" onchange="applyFilters()"><option value="">T√ºm Tipler</option></select>
                <select id="filterResult" onchange="applyFilters()">
                    <option value="">T√ºm Sonu√ßlar</option>
                    <option value="TP">TP - Doƒüru</option>
                    <option value="FN">FN - Eksik</option>
                    <option value="FP">FP - Fazla</option>
                    <option value="LOCK">Kilitli</option>
                </select>
                <button class="btn" onclick="exportData()">Excel ƒ∞ndir</button>
            </div>
            <div style="overflow-x: auto;">
                <table id="detailsTable">
                    <thead>
                        <tr>
                            <th>Tarih</th>
                            <th>ID</th>
                            <th>Tip</th>
                            <th>Vardiya</th>
                            <th>Sonu√ß</th>
                            <th>S√ºre(s)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Config Section -->
        <div id="section-config" class="section">
            <h2>Ayarlar</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div>
                    <h3>Vardiya Saatleri</h3>
                    <div id="shiftConfig"></div>
                    <button class="btn" onclick="saveConfig()">Kaydet</button>
                </div>
                <div>
                    <h3>OpenAI API (Opsiyonel)</h3>
                    <div class="config-group">
                        <label>API Key</label>
                        <input type="password" id="apiKey" placeholder="sk-...">
                    </div>
                    <button class="btn" onclick="saveApiKey()">API Key Kaydet</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== GLOBAL VARIABLES ====================
        let rawData = [];
        let processedData = [];
        let columnMap = {};
        let charts = {};

        // Configuration
        let config = {
            shifts: {
                'Tolga': { start: 2, end: 8 },
                'shikai': { start: 2, end: 8 },
                'Derin': { start: 8, end: 14 },
                'Deniz': { start: 14, end: 20 },
                '√áiƒüdem': { start: 20, end: 23 },
                'Dilan': { start: 23, end: 2, overnight: true }
            },
            rules: {
                'Porn': 'required',
                'Abuse': 'required',
                'Harassment': 'required',
                'Religion': 'optional',
                'Spam': 'optional'
            }
        };

        // Load saved config
        if(localStorage.getItem('cs_config')) {
            config = JSON.parse(localStorage.getItem('cs_config'));
        }

        // ==================== NAVIGATION ====================
        function showSection(name) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));

            // Show selected
            document.getElementById('section-' + name).classList.add('active');
            document.getElementById('btn-' + name).classList.add('active');

            // Render if needed
            if(name === 'scores' && processedData.length > 0) renderScores();
            if(name === 'config') renderConfig();
        }

        // ==================== FILE UPLOAD ====================
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        dropZone.addEventListener('click', function() {
            fileInput.click();
        });

        dropZone.addEventListener('dragover', function(e) {
            e.preventDefault();
            dropZone.style.background = '#e0e0ff';
        });

        dropZone.addEventListener('dragleave', function() {
            dropZone.style.background = '#fafafa';
        });

        dropZone.addEventListener('drop', function(e) {
            e.preventDefault();
            dropZone.style.background = '#fafafa';
            if(e.dataTransfer.files.length) {
                handleFile(e.dataTransfer.files[0]);
            }
        });

        fileInput.addEventListener('change', function(e) {
            if(e.target.files.length) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            console.log('File selected:', file.name);
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

                    const headers = jsonData[0];
                    rawData = jsonData.slice(1).map(row => {
                        const obj = {};
                        headers.forEach((h, i) => obj[h] = row[i]);
                        return obj;
                    });

                    console.log('Data loaded:', rawData.length, 'rows');
                    showMappingPanel(headers);
                } catch(err) {
                    alert('Dosya okuma hatasƒ±: ' + err.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function showMappingPanel(headers) {
            const panel = document.getElementById('mappingPanel');
            const container = document.getElementById('mappingContainer');
            panel.classList.remove('hidden');

            const fields = [
                { key: 'time', label: 'Rapor Zamanƒ± (‰∏æÊä•Êó∂Èó¥)', required: true },
                { key: 'id', label: '≈ûikayet Edilen ID (Ë¢´‰∏æÊä•‰∫∫)', required: true },
                { key: 'type', label: 'Rapor Tipi (‰∏æÊä•Á±ªÂûã)', required: true },
                { key: 'text', label: 'Rapor Metni (‰∏æÊä•ÂÜÖÂÆπ)', required: false },
                { key: 'handler', label: 'ƒ∞≈ülem Yapan (ÂõûÂ§ç‰∫∫)', required: false },
                { key: 'handle_time', label: 'ƒ∞≈ülem Zamanƒ± (ÂõûÂ§çÊó∂Èó¥)', required: false },
                { key: 'result', label: 'Sonu√ß (Â§ÑÁΩöÁªìÊûú)', required: false }
            ];

            container.innerHTML = fields.map(f => `
                <div class="config-group">
                    <label>${f.label} ${f.required ? '*' : ''}</label>
                    <select id="map_${f.key}">
                        <option value="">Se√ßin...</option>
                        ${headers.map(h => `<option value="${h}">${h}</option>`).join('')}
                    </select>
                </div>
            `).join('');

            // Auto-match
            fields.forEach(f => {
                const select = document.getElementById('map_' + f.key);
                const match = headers.find(h => 
                    h.toLowerCase().includes(f.key) || 
                    f.label.toLowerCase().includes(h.toLowerCase())
                );
                if(match) select.value = match;
            });
        }

        // ==================== DATA PROCESSING ====================
        function processData() {
            // Get mappings
            columnMap = {
                time: document.getElementById('map_time').value,
                id: document.getElementById('map_id').value,
                type: document.getElementById('map_type').value,
                text: document.getElementById('map_text')?.value || '',
                handler: document.getElementById('map_handler')?.value || '',
                handle_time: document.getElementById('map_handle_time')?.value || '',
                result: document.getElementById('map_result')?.value || ''
            };

            if(!columnMap.time || !columnMap.id) {
                alert('Zorunlu alanlarƒ± doldurun!');
                return;
            }

            analyzeData();
            showSection('dashboard');
            renderDashboard();
        }

        function analyzeData() {
            processedData = [];
            const userLastAction = {};

            // Sort by time
            rawData.sort((a, b) => new Date(a[columnMap.time]) - new Date(b[columnMap.time]));

            rawData.forEach(row => {
                const reportTime = new Date(row[columnMap.time]);
                const reportedId = row[columnMap.id];
                const reportType = row[columnMap.type] || 'Unknown';
                const handler = row[columnMap.handler] || '';
                const handleTime = row[columnMap.handle_time] ? new Date(row[columnMap.handle_time]) : null;
                const actionResult = row[columnMap.result] || '';

                const hour = reportTime.getHours();

                // Find shift
                let shiftCS = '';
                for(const [cs, shift] of Object.entries(config.shifts)) {
                    if(shift.overnight) {
                        if(hour >= shift.start || hour < shift.end) shiftCS = cs;
                    } else {
                        if(hour >= shift.start && hour < shift.end) shiftCS = cs;
                    }
                }

                // 24h lock check
                let lockStatus = 'NONE';
                if(userLastAction[reportedId]) {
                    const diff = (reportTime - userLastAction[reportedId]) / (1000 * 60 * 60);
                    if(diff < 24) lockStatus = 'LOCKED';
                }

                const actionTaken = !!(handleTime || actionResult);

                // Duration
                let duration = null;
                if(actionTaken && handleTime) {
                    duration = (handleTime - reportTime) / (1000 * 60 * 60); // hours
                }

                // Expected action
                let expected = 'no';
                if(config.rules[reportType] === 'required') expected = 'yes';

                // Evaluation
                let eval = '';
                if(lockStatus === 'LOCKED' && !actionTaken) eval = 'LOCK_OK';
                else if(lockStatus === 'LOCKED' && actionTaken) eval = 'LOCK_VIOLATION';
                else if(expected === 'yes' && actionTaken) eval = 'TP';
                else if(expected === 'yes' && !actionTaken) eval = 'FN';
                else if(expected === 'no' && actionTaken) eval = 'FP';
                else eval = 'TN';

                // Update last action
                if(actionTaken && handleTime) {
                    userLastAction[reportedId] = handleTime;
                }

                processedData.push({
                    reportTime, reportedId, reportType, handler, shiftCS,
                    actionTaken, duration, expected, evaluation: eval, lockStatus
                });
            });

            console.log('Processed:', processedData.length);
        }

        // ==================== DASHBOARD ====================
        function renderDashboard() {
            const counts = {
                TP: processedData.filter(d => d.evaluation === 'TP').length,
                FN: processedData.filter(d => d.evaluation === 'FN').length,
                FP: processedData.filter(d => d.evaluation === 'FP').length,
                total: processedData.length
            };

            document.getElementById('val-tp').textContent = counts.TP;
            document.getElementById('val-fn').textContent = counts.FN;
            document.getElementById('val-fp').textContent = counts.FP;
            document.getElementById('val-total').textContent = counts.total;

            // Charts
            if(charts.c1) charts.c1.destroy();
            if(charts.c2) charts.c2.destroy();

            const ctx1 = document.getElementById('chart1').getContext('2d');
            charts.c1 = new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['TP', 'FN', 'FP', 'TN', 'Lock'],
                    datasets: [{
                        data: [
                            counts.TP,
                            counts.FN,
                            counts.FP,
                            processedData.filter(d => d.evaluation === 'TN').length,
                            processedData.filter(d => d.lockStatus === 'LOCKED').length
                        ],
                        backgroundColor: ['#28a745', '#ffc107', '#dc3545', '#17a2b8', '#6c757d']
                    }]
                }
            });

            // Hourly chart
            const hours = {};
            for(let i=0; i<24; i++) hours[i] = 0;
            processedData.forEach(d => hours[d.reportTime.getHours()]++);

            const ctx2 = document.getElementById('chart2').getContext('2d');
            charts.c2 = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: Object.keys(hours).map(h => h + ':00'),
                    datasets: [{ label: 'Rapor', data: Object.values(hours), backgroundColor: '#667eea' }]
                }
            });
        }

        // ==================== CS SCORES ====================
        function calculateScore(csData) {
            const total = csData.length;
            const correct = csData.filter(d => d.evaluation === 'TP' || d.evaluation === 'TN').length;
            const rate = total > 0 ? (correct / total) * 100 : 0;

            let effScore = 0;
            if(rate >= 80) effScore = 18;
            else if(rate >= 60) effScore = 13;
            else if(rate >= 40) effScore = 8;
            else effScore = 3;

            const processed = csData.filter(d => d.actionTaken && d.duration !== null);
            let speedScore = 0;
            if(processed.length > 0) {
                const avg = processed.reduce((s, d) => s + d.duration, 0) / processed.length;
                speedScore = avg <= 24 ? 12 : 4;
            }

            const totalScore = (effScore * 0.6) + (speedScore * 0.4);

            return {
                rate: rate.toFixed(1),
                effScore,
                speedScore,
                totalScore: totalScore.toFixed(1),
                total,
                processed: processed.length
            };
        }

        function renderScores() {
            const groups = {};
            processedData.forEach(d => {
                if(!groups[d.shiftCS]) groups[d.shiftCS] = [];
                groups[d.shiftCS].push(d);
            });

            const container = document.getElementById('csScores');
            container.innerHTML = '';

            const scores = [];
            Object.entries(groups).forEach(([name, data]) => {
                const s = calculateScore(data);
                scores.push({name, ...s});

                container.innerHTML += `
                    <div class="cs-card">
                        <h3>${name}</h3>
                        <div style="font-size: 32px; font-weight: bold; color: #667eea; margin: 10px 0;">
                            ${s.totalScore} <small style="font-size: 14px; color: #666;">/ 30</small>
                        </div>
                        <div>Etkililik: %${s.rate} (${s.effScore}p)</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${(s.effScore/18)*100}%; background: #28a745;"></div>
                        </div>
                        <div style="margin-top: 10px;">Hƒ±z Puanƒ±: ${s.speedScore}p</div>
                        <div>Toplam: ${s.total} | ƒ∞≈ülem: ${s.processed}</div>
                    </div>
                `;
            });

            // Chart
            if(charts.cs) charts.cs.destroy();
            const ctx = document.getElementById('csChart').getContext('2d');
            charts.cs = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: scores.map(s => s.name),
                    datasets: [{
                        label: 'Toplam Puan',
                        data: scores.map(s => s.totalScore),
                        backgroundColor: '#667eea'
                    }]
                },
                options: { scales: { y: { beginAtZero: true, max: 30 } } }
            });
        }

        // ==================== DETAILS ====================
        function applyFilters() {
            const cs = document.getElementById('filterCS').value;
            const type = document.getElementById('filterType').value;
            const result = document.getElementById('filterResult').value;

            const filtered = processedData.filter(d => {
                if(cs && d.shiftCS !== cs) return false;
                if(type && d.reportType !== type) return false;
                if(result && d.evaluation !== result) return false;
                return true;
            });

            renderTable(filtered);
        }

        function renderTable(data) {
            const tbody = document.querySelector('#detailsTable tbody');
            tbody.innerHTML = data.map(d => `
                <tr>
                    <td>${d.reportTime.toLocaleString()}</td>
                    <td>${d.reportedId}</td>
                    <td>${d.reportType}</td>
                    <td>${d.shiftCS}</td>
                    <td><span class="badge badge-${d.evaluation.toLowerCase()}">${d.evaluation}</span></td>
                    <td>${d.duration ? d.duration.toFixed(1) : '-'}</td>
                </tr>
            `).join('');
        }

        // ==================== EXPORT ====================
        function exportData() {
            const data = processedData.map(d => ({
                Tarih: d.reportTime.toLocaleString(),
                ID: d.reportedId,
                Tip: d.reportType,
                CS: d.shiftCS,
                Sonuc: d.evaluation,
                Sure: d.duration ? d.duration.toFixed(1) : '-'
            }));

            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Rapor");
            XLSX.writeFile(wb, "CS_Analiz.xlsx");
        }

        // ==================== CONFIG ====================
        function renderConfig() {
            const div = document.getElementById('shiftConfig');
            div.innerHTML = Object.entries(config.shifts).map(([name, s]) => `
                <div class="config-group">
                    <label>${name}</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="number" id="shift_${name}_start" value="${s.start}" placeholder="Ba≈ülangƒ±√ß" style="width: 100px;">
                        <input type="number" id="shift_${name}_end" value="${s.end}" placeholder="Biti≈ü" style="width: 100px;">
                        <label><input type="checkbox" id="shift_${name}_overnight" ${s.overnight ? 'checked' : ''}> Gece</label>
                    </div>
                </div>
            `).join('');
        }

        function saveConfig() {
            Object.keys(config.shifts).forEach(name => {
                config.shifts[name].start = parseInt(document.getElementById(`shift_${name}_start`).value);
                config.shifts[name].end = parseInt(document.getElementById(`shift_${name}_end`).value);
                config.shifts[name].overnight = document.getElementById(`shift_${name}_overnight`).checked;
            });
            localStorage.setItem('cs_config', JSON.stringify(config));
            alert('Kaydedildi!');
        }

        function saveApiKey() {
            const key = document.getElementById('apiKey').value;
            localStorage.setItem('openai_key', key);
            alert('API Key kaydedildi!');
        }

        // ==================== DEMO ====================
        function loadDemoData() {
            console.log('Loading demo data...');
            const demo = [];
            const types = Object.keys(config.rules);

            for(let i=0; i<50; i++) {
                const date = new Date('2026-02-26');
                date.setHours(Math.floor(Math.random() * 24));
                date.setMinutes(Math.floor(Math.random() * 60));

                const type = types[Math.floor(Math.random() * types.length)];
                const hasAction = Math.random() > 0.3;
                const handler = hasAction ? Object.keys(config.shifts)[Math.floor(Math.random() * 6)] : '';

                demo.push({
                    '‰∏æÊä•Êó∂Èó¥': date.toISOString(),
                    'Ë¢´‰∏æÊä•‰∫∫': 'user_' + Math.floor(Math.random() * 20),
                    '‰∏æÊä•Á±ªÂûã': type,
                    '‰∏æÊä•ÂÜÖÂÆπ': 'Demo i√ßerik ' + i,
                    'ÂõûÂ§ç‰∫∫': handler,
                    'ÂõûÂ§çÊó∂Èó¥': hasAction ? new Date(date.getTime() + Math.random() * 3600000).toISOString() : '',
                    'Â§ÑÁΩöÁªìÊûú': hasAction ? 'Mute' : ''
                });
            }

            rawData = demo;
            showMappingPanel(Object.keys(demo[0]));
        }

        // Load saved API key
        const savedKey = localStorage.getItem('openai_key');
        if(savedKey) document.getElementById('apiKey').value = savedKey;

        console.log('App loaded successfully');
    </script>
</body>
</html>
